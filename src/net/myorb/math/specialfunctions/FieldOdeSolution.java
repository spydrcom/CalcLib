
package net.myorb.math.specialfunctions;

import net.myorb.math.computational.CommonSplineDescription;
import net.myorb.math.expressions.managers.ExpressionFloatingFieldManager;

import java.util.ArrayList;
import java.util.List;

/**
 * an attempt to demonstrate building a spline for a sequence of RK4 solution approximations.
 *  the y and yPrime exports of this class are the y(x) and y'(x) entries for calculations using the splines.
 *  see FieldSplineTest.txt for a script running precision tests on this spline as a solution to the ODE.
 * @author Michael Druckman
 */
public class FieldOdeSolution extends CommonSplineDescription <Double>
{

	static Double KNOTS [];
	static List <Double[]> COEFFICIENTS;

	public static final ExpressionFloatingFieldManager manager = new ExpressionFloatingFieldManager ();

	// Chebyshev T polynomial coefficients for the spline segments

	static
	{
		KNOTS = new Double[]
			{1.0, 1.5, 2.6, 5.0, 6.2};						// 6 segments in this spline
		COEFFICIENTS = new ArrayList <Double[]> ();			// a set of coefficients per segment
		COEFFICIENTS.add (new Double[]{9.564918429079327, 7.973537352127461, -0.4696079065205874, 0.08042966042426501, -0.050257530123587774, 0.033549066875528874, -0.020448778377206114, 0.011289077348111826, -0.005608464863893272, 0.002486924344828884, -9.828347225970193E-4, 3.3907413831583933E-4, -9.96301386774935E-5, 2.26673232484397E-5, -3.0450775713209238E-6, -3.0150061903558493E-7, 3.368443828475718E-7, -1.1347153395159633E-7, 2.1599607295530972E-8, -9.517820827863971E-10, -9.59309202401803E-10, 4.130170940659558E-10, -1.0326483290898568E-10, 1.8698688342691353E-11, -2.581751225151375E-12, 2.741357250241056E-13, -2.2094443903526986E-14, 1.3085019642532764E-15, -5.362003070146864E-17, 1.3533805396492145E-18, -1.5756875448226327E-20});
		COEFFICIENTS.add (new Double[]{9.542968825784419, 8.017282247325221, -0.5145381741844997, 0.1290488240493407, -0.10051665179219005, 0.07729339807505553, -0.04997703174108209, 0.02555782218814759, -0.0096441774797425, 0.00230839315469497, -1.3177124096974907E-4, -1.2808203691742925E-4, 4.435981360810274E-5, -2.9589497493706757E-6, -8.453209487795765E-7, -5.269328114428598E-7, 4.6867780868858043E-7, -1.29318771413005E-7, 1.1931446274342126E-8, 5.245283374941747E-10, 6.596948810426525E-10, -4.383940247693103E-10, 7.877548845741159E-11, 7.639858368730383E-12, -6.704592635296593E-12, 1.599542322975412E-12, -2.2086596984097594E-13, 1.926219942606669E-14, -1.0332415724693316E-15, 3.0106354427199993E-17, -3.308139628582244E-19});
		COEFFICIENTS.add (new Double[]{9.368304000640503, 8.317817499032687, -0.6956761614755926, 0.18111412391062598, -0.06649731876808332, 0.0152213404271022, 8.195453757014332E-4, -0.0024083657513750203, 0.0011026641521330767, -2.8637057882343274E-4, 4.297275922013432E-5, -2.201471067964548E-6, -4.850360809616763E-7, 1.572178760233779E-7, -4.3596243581949775E-8, 1.042564271980561E-8, -8.220216307213119E-10, -2.689915916777007E-10, 4.724817657954941E-11, 1.7820518242943254E-11, -8.460206004479602E-12, 1.432011070907809E-12, -4.503071300680834E-14, -3.14531883650573E-14, 7.886254522505287E-15, -1.0197839497473317E-15, 8.0771318932291E-17, -3.613656601530227E-18, 4.466808292843951E-20, 3.3638210216667036E-21, -1.2292223139872026E-22});
		COEFFICIENTS.add (new Double[]{9.406589932167172, 8.191767406079027, -0.5280561034409834, 0.053217604670631025, -0.007457267585416573, 6.836886516473881E-4, -1.2598824726040055E-5, -2.2486977849464515E-6, -3.2340190216481913E-7, 5.007475612830926E-8, 1.6002232675797913E-8, -4.037362906692245E-9, 2.310214473622924E-10, 2.381117924443219E-11, -3.681033506030211E-12, 1.4154236955165138E-13, -7.786365790020558E-15, 1.532175949380298E-15, -2.2804958773481776E-16, 4.5668924142592956E-17, -2.96572738567683E-18, -5.334216225457214E-19, 6.45615810698436E-20, 4.2393398823312346E-21, -7.672830425996602E-22, -3.232210220959864E-23, 1.142445478487855E-23, -8.240156970612926E-25, 2.3519999958753823E-26, -7.429594989118735E-29, -6.237232787682149E-30});
		COEFFICIENTS.add (new Double[]{9.283169932792056, 8.251229396360479, -0.4906856029041028, 0.028200515786655264, -0.0012651599685023175, -4.546187424026439E-5, 1.2236371417750958E-5, -3.9927334109745823E-7, -8.11685603376422E-8, 7.572061594603331E-9, 5.353281343869054E-10, -1.2651220229666375E-10, 6.80794696897719E-12, -1.7278742571516331E-13, 2.8776919976530256E-14, -1.289305312206558E-15, -1.2477997867826339E-16, -8.115039792232603E-18, 1.326039261794007E-18, 2.005427153910375E-19, -2.4502285815976928E-20, -4.2362058436877225E-22, 1.401859596750801E-22, -1.8832046906417841E-25, -9.194211958703383E-25, 6.524172718883232E-26, -1.1590009425781335E-27, -1.0321692405416858E-28, 8.018476616131789E-30, -2.382268244215216E-31, 2.7535314052224113E-33});
		COEFFICIENTS.add (new Double[]{9.472582605457795, 7.994159136704875, -0.4077412832406153, 0.01573012366306384, -9.339859780424231E-4, 1.1921283223929782E-4, -1.053872694366935E-5, 1.8352615415969433E-7, 2.858624833771458E-8, 9.65188985862775E-10, -3.4781229523461E-10, 7.474556495910695E-12, 1.1570169138802745E-12, -2.7277397273558806E-14, -3.952951545127883E-15, 7.029855596313886E-17, 1.5043988740341264E-17, -4.570741609328316E-19, -6.881474765315238E-21, -5.4013328761988406E-21, 5.951608497228511E-22, -4.9002933429334724E-24, -1.0524859127494286E-24, -3.9323039410064667E-26, 1.6160172481637793E-27, 6.754729964370145E-28, -5.028569799204683E-29, 5.4932825306971755E-31, 6.211745320733649E-32, -2.4984513213983442E-33, 2.9094950638024663E-35});
	}

	protected FieldOdeSolution ()
	{ super (manager); buildFromArray (KNOTS, COEFFICIENTS); }
	private static FieldOdeSolution solution = new FieldOdeSolution ();

	/**
	 * evaluation of y(x)
	 * @param x the parameter to the function
	 * @return the function result
	 */
	public static double y (double x)
	{
		return solution.functionEval (x);
	}

	/**
	 * evaluation of y'(x)
	 * @param x the parameter to the derivative function
	 * @return the function result
	 */
	public static double yPrime (double x)
	{
		return solution.derivativeEval (x);
	}

/*

spline was taken from a series of RK4 approximations interpolated by Chebyshev T polynomial regression

start at t=0, y=10
Y0=10;T0=0;h=0.1;N=30
r^2 = -58.809585404166526

coefficients
calc yc ; calc ypc
(9.564918429079327, 7.973537352127461, -0.4696079065205874, 0.08042966042426501, -0.050257530123587774, 0.033549066875528874, -0.020448778377206114, 0.011289077348111826, -0.005608464863893272, 0.002486924344828884, -9.828347225970193E-4, 3.3907413831583933E-4, -9.96301386774935E-5, 2.26673232484397E-5, -3.0450775713209238E-6, -3.0150061903558493E-7, 3.368443828475718E-7, -1.1347153395159633E-7, 2.1599607295530972E-8, -9.517820827863971E-10, -9.59309202401803E-10, 4.130170940659558E-10, -1.0326483290898568E-10, 1.8698688342691353E-11, -2.581751225151375E-12, 2.741357250241056E-13, -2.2094443903526986E-14, 1.3085019642532764E-15, -5.362003070146864E-17, 1.3533805396492145E-18, -1.5756875448226327E-20)
(8.487995558542941, -2.6377342118069973, 1.0289164128309627, -0.7593025857246481, 0.5463384502853728, -0.35724234473594596, 0.2108477815300839, -0.11185700420947252, 0.052800698656518374, -0.022121566387180165, 0.008036060449598467, -0.002464871935239786, 5.764294066500028E-4, -7.37486069799421E-5, -1.2920997809429318E-5, 1.1513565017043789E-5, -3.87597923836177E-6, 7.345447659214902E-7, -1.7947084007495797E-8, -4.304109671762488E-8, 1.8220635138387294E-8, -4.668728621552752E-9, 8.739171876171486E-10, -1.2507597355738122E-10, 1.3777523853346258E-11, -1.1519147501152124E-12, 7.073760214097657E-14, -3.0036671318091376E-15, 7.849607129965444E-17, -9.454125268935797E-19)


calc y 1
17.119564003723834
T0=1 ; Y0 = 17.119564003723834 
this is the first segment interpolation used to set initial values of segment 2

calc yc ; calc ypc
(9.542968825784419, 8.017282247325221, -0.5145381741844997, 0.1290488240493407, -0.10051665179219005, 0.07729339807505553, -0.04997703174108209, 0.02555782218814759, -0.0096441774797425, 0.00230839315469497, -1.3177124096974907E-4, -1.2808203691742925E-4, 4.435981360810274E-5, -2.9589497493706757E-6, -8.453209487795765E-7, -5.269328114428598E-7, 4.6867780868858043E-7, -1.29318771413005E-7, 1.1931446274342126E-8, 5.245283374941747E-10, 6.596948810426525E-10, -4.383940247693103E-10, 7.877548845741159E-11, 7.639858368730383E-12, -6.704592635296593E-12, 1.599542322975412E-12, -2.2086596984097594E-13, 1.926219942606669E-14, -1.0332415724693316E-15, 3.0106354427199993E-17, -3.308139628582244E-19)
(8.989118533369677, -3.6178961331812527, 1.9436725720889172, -1.5597434364432545, 1.169379627792873, -0.755610222105734, 0.39644564704231755, -0.15588584121274907, 0.038636136408251344, -0.0015790015368690577, -0.0029149403762581184, 0.0010564232825259238, -9.713556407467504E-5, -8.212244068541723E-6, -2.020287059103745E-5, 1.545674249728642E-5, -4.394886247751655E-6, 4.5905261925184587E-7, 1.9519802905155403E-9, 2.9520553375529347E-8, -1.79800965342631E-8, 3.1327581338232466E-9, 4.324525060479326E-10, -3.333633583028633E-10, 8.101902108633498E-11, -1.1542911808626803E-11, 1.041904937564379E-12, -5.788137689605406E-14, 1.7461685567775996E-15, -1.9848837771493464E-17)

calc y 1.5
20.18897716808364
segment 2 used to set initial values of segment 3
T0=1.5 ; Y0 = 20.18897716808364 
r^2 = 1.0

calc yc ; calc ypc
(9.368304000640503, 8.317817499032687, -0.6956761614755926, 0.18111412391062598, -0.06649731876808332, 0.0152213404271022, 8.195453757014332E-4, -0.0024083657513750203, 0.0011026641521330767, -2.8637057882343274E-4, 4.297275922013432E-5, -2.201471067964548E-6, -4.850360809616763E-7, 1.572178760233779E-7, -4.3596243581949775E-8, 1.042564271980561E-8, -8.220216307213119E-10, -2.689915916777007E-10, 4.724817657954941E-11, 1.7820518242943254E-11, -8.460206004479602E-12, 1.432011070907809E-12, -4.503071300680834E-14, -3.14531883650573E-14, 7.886254522505287E-15, -1.0197839497473317E-15, 8.0771318932291E-17, -3.613656601530227E-18, 4.466808292843951E-20, 3.3638210216667036E-21, -1.2292223139872026E-22)
(8.917808657261379, -3.2863594564246164, 1.1999823164573804, -0.5036548105222455, 0.11329757299362492, 0.028323739622421063, -0.03891583127739708, 0.018489195114003865, -0.005198710758146799, 8.465686798746364E-4, -4.404033932500769E-5, -1.2886504528049776E-5, 4.392024170212358E-6, -1.2456385849695435E-6, 3.0435939360453173E-7, -2.494376467494998E-8, -8.409887989636489E-9, 1.360927508131997E-9, 7.358261274053368E-10, -3.400068487317816E-10, 5.864643417349312E-11, -1.5986085525975238E-12, -1.4980308046348657E-12, 3.82742819702043E-13, -5.1184139842229954E-14, 4.202602621789241E-15, -1.949423548633756E-16, 2.4940373101086895E-18, 1.951016192566688E-19, -7.375333883923216E-21)

segment 4
calc y 2.6
25.97059668096534
T0=2.6 ; Y0 = 25.97059668096534 
r^2 = 0.9999999999999997

calc yc ; calc ypc
(9.46665233095224, 8.114433512524297, -0.5058538119322376, 0.050305993643640634, -0.006302264069571125, -1.882474623328776E-4, 2.882886658097754E-4, -5.055428848335162E-5, 2.025899663047121E-6, 2.655368731138046E-7, 7.643699841381721E-9, 1.0482215265738918E-10, -2.509116066190268E-9, 2.848834650594478E-10, 3.5295371239080704E-11, -4.3357552887558595E-12, -1.0350553736864986E-12, 1.759433967992465E-13, -3.0848029630876373E-15, -6.798098215661251E-16, 2.40303731992645E-16, -9.011064053220696E-17, 1.2100252410615936E-17, 6.747636840381282E-20, -1.7857943501979732E-19, 1.6571576529575722E-20, 2.638595797320703E-23, -1.0906436778395363E-22, 8.615070930954644E-24, -2.98030933457538E-25, 4.091265835424617E-27)
(8.264058770750498, -2.070341388290934, 0.29925051645240136, -0.046926140561983985, -0.002585445409442397, 0.0034919719945850037, -7.029707861136206E-4, 3.250800486769882E-5, 4.789252653301824E-6, 9.361025894488802E-8, 9.588937253343164E-9, -5.9263737882746384E-8, 7.2828498948806056E-9, 9.550477058200482E-10, -1.2412019666503826E-10, -3.3222688874211456E-11, 5.952461997637527E-12, -1.0091691624350373E-13, -2.961349353685404E-14, 1.0135990427651213E-14, -3.780720317341293E-15, 5.238411479454137E-16, 3.926585011399702E-18, -8.56995812168758E-18, 8.22672064824312E-19, 1.854759262690351E-21, -5.906761654474033E-21, 4.826894480835855E-22, -1.7285794140537204E-23, 2.45475950125477E-25)

segment 5
calc y 3.6
30.247536471033918
T0=3.6 ; Y0 = 30.247536471033918 
r^2 = 0.9999936359704845

calc yc ; calc ypc    
(9.7165767372422, 7.746710666998025, -0.3512240500998004, 0.01358657269984595, -0.0030200874961366364, 5.901079339837795E-4, -1.9002600597846364E-5, -1.0214435448310243E-5, 1.2428790005797818E-6, 4.742898856482304E-8, -1.3239089499292318E-8, -2.650641645600501E-10, 4.80929102519703E-11, 2.1977133029584584E-11, -3.310872307912815E-12, 1.671750366843202E-13, -7.480188732883993E-15, 1.7038602644329668E-15, -4.212193853658274E-16, 5.865512403607643E-17, -2.0314460159742474E-18, -3.6365489661711236E-19, 2.719866142166708E-20, 1.7308389352107868E-21, -2.8275041844129134E-22, 3.588317701605677E-23, -6.73275878565357E-24, 7.673502286189928E-25, -4.6798745695328393E-26, 1.4745520598470695E-27, -1.9124426626232637E-29)
(7.790349847952775, -1.4292653092319787, 0.08727836190950057, -0.024369108832777146, 0.0057589257104248524, -2.084088636840543E-4, -1.4215362941294207E-4, 1.9622343490102074E-5, 8.48466863401315E-7, -2.637205191744329E-7, -5.254930765499721E-9, 1.061270811413379E-9, 5.764808548213815E-10, -9.295903463390856E-11, 5.0753960521823126E-12, -2.546100123497394E-13, 6.014495165270616E-14, -1.5243972897451624E-14, 2.2137026619852923E-15, -8.00750242818358E-17, -1.5192051385611855E-17, 1.182816357134091E-18, 8.145427230686393E-20, -1.3924745419260507E-20, 1.8356812871677354E-21, -3.527253340785216E-22, 4.152243636489674E-23, -2.6218772245359643E-24, 8.552401947113003E-26, -1.1474655975739582E-27)

segment 6
calc y 5
34.98191470862137
T0=5 ; Y0 = 34.98191470862137 
r^2 = 0.999999999999838

calc yc ; calc ypc    
(9.283169932792056, 8.251229396360479, -0.49068560290410285, 0.028200515786655264, -0.0012651599685023175, -4.546187424026439E-5, 1.2236371417750958E-5, -3.9927334109745823E-7, -8.11685603376422E-8, 7.572061594603331E-9, 5.353281343869054E-10, -1.2651220229666375E-10, 6.80794696897719E-12, -1.7278742571516331E-13, 2.8776919976530256E-14, -1.289305312206558E-15, -1.2477997867826339E-16, -8.115039792232603E-18, 1.326039261794007E-18, 2.005427153910375E-19, -2.4502285815976928E-20, -4.2362058436877225E-22, 1.401859596750801E-22, -1.8832046906417841E-25, -9.194211958703383E-25, 6.524172718883232E-26, -1.1590009425781335E-27, -1.0321692405416858E-28, 8.018476616131789E-30, -2.382268244215216E-31, 2.7535314052224113E-33)
(8.33560090619051, -1.9727181427336271, 0.1687430196600624, -0.009975731117215707, -4.6007505986917646E-4, 1.4554863080283177E-4, -5.456317466532618E-6, -1.287826210179718E-6, 1.3350930883179688E-7, 1.0870755222557032E-8, -2.7877998710630907E-9, 1.641925348189237E-10, -4.531420536487665E-12, 8.018075634711248E-13, -3.894746789341857E-14, -3.946195871722294E-15, -2.683085272218353E-16, 4.676344598213463E-17, 7.602825714073188E-18, -9.739674424496245E-19, -1.7797470786237004E-20, 6.123990189452636E-21, -5.4062427485653315E-24, -4.419203625088791E-23, 3.2564988283868744E-24, -5.981884911167524E-26, -5.587531054741552E-27, 4.491999023876936E-28, -1.381715581644825E-29, 1.6521188431334468E-31)

replaced
calc yc
(9.406589932167172, 8.191767406079027, -0.5280561034409834, 0.053217604670631025, -0.007457267585416573, 6.836886516473881E-4, -1.2598824726040055E-5, -2.2486977849464515E-6, -3.2340190216481913E-7, 5.007475612830926E-8, 1.6002232675797913E-8, -4.037362906692245E-9, 2.310214473622924E-10, 2.381117924443219E-11, -3.681033506030211E-12, 1.4154236955165138E-13, -7.786365790020558E-15, 1.532175949380298E-15, -2.2804958773481776E-16, 4.5668924142592956E-17, -2.96572738567683E-18, -5.334216225457214E-19, 6.45615810698436E-20, 4.2393398823312346E-21, -7.672830425996602E-22, -3.232210220959864E-23, 1.142445478487855E-23, -8.240156970612926E-25, 2.3519999958753823E-26, -7.429594989118735E-29, -6.237232787682149E-30)
(9.34593401742238, 8.253716767047383, -0.5225905314043386, 0.036556317956378065, -5.142721682384471E-4, -6.833979856307165E-4, 1.1557092447272852E-4, -7.529994155634756E-6, 6.418796799102269E-7, -1.1840940444238472E-7, -7.56940661420426E-10, 2.069469946372853E-9, -4.569377467003842E-11, -1.0277939185945932E-11, -1.6546723011323064E-12, 7.262105683296861E-14, 2.9375476037653534E-14, 1.4446621886964291E-15, -4.853596764741973E-16, 1.2527327640010994E-17, -7.482411198125971E-18, 1.1869274660474057E-18, 1.0910751792743247E-19, -2.787040088126641E-20, 2.965993648802036E-22, 2.6519057385338493E-22, -2.0596109370042504E-23, 4.658165383996467E-27, 6.706432555297668E-26, -3.2168821982233313E-27, 4.993281131400829E-29)

segment 7
calc y 6.2
38.12951327833999
T0=6.2 ; Y0 = 38.12951327833999 
r^2 = 1.0

calc yc ; calc ypc    
(9.472582605457795, 7.994159136704875, -0.4077412832406153, 0.01573012366306384, -9.339859780424231E-4, 1.1921283223929782E-4, -1.053872694366935E-5, 1.8352615415969433E-7, 2.858624833771458E-8, 9.65188985862775E-10, -3.4781229523461E-10, 7.474556495910695E-12, 1.1570169138802745E-12, -2.7277397273558806E-14, -3.952951545127883E-15, 7.029855596313886E-17, 1.5043988740341264E-17, -4.570741609328316E-19, -6.881474765315238E-21, -5.4013328761988406E-21, 5.951608497228511E-22, -4.9002933429334724E-24, -1.0524859127494286E-24, -3.9323039410064667E-26, 1.6160172481637793E-27, 6.754729964370145E-28, -5.028569799204683E-29, 5.4932825306971755E-31, 6.211745320733649E-32, -2.4984513213983442E-33, 2.9094950638024663E-35)
(8.041946865306912, -1.6385630350587388, 0.09557545720406911, -0.007597902096277714, 0.001194715225686083, -1.2601427193832898E-4, 2.5869032931050424E-6, 4.5045138570321454E-7, 1.7537134869321574E-8, -6.928587700218671E-9, 1.6373312379162194E-10, 2.7658204473529806E-11, -7.071191184133433E-13, -1.1020145959678179E-13, 2.093210699185777E-15, 4.811836667989353E-16, -1.574597970838888E-17, -2.2397289198514357E-19, -2.0545823667260338E-19, 2.376019956620501E-20, -2.0758737704743146E-22, -4.62344227090355E-23, -1.775056644225635E-24, 7.495745193935162E-26, 3.380316863733985E-26, -2.611375972509786E-27, 2.951881548912364E-29, 3.480323076649125E-30, -1.4491017664110397E-31, 1.7456970382814797E-33)

 */
 
}

